    # Reverse Proxy (with exclusion of local Letsencrypt challenge path)
    ProxyPassMatch ^/.well-known/acme-challenge/ !
{
    if ($WebSockets eq 'enabled' ) {
        my $ws = $Target;
        $ws =~ s/(http|https):\/+//;
        $OUT .= qq(
    # Websockets proxypass
    RewriteCond \%\{HTTP:Upgrade\} websocket [NC]
    RewriteCond \%\{HTTP:Connection\} upgrade [NC]
);
        if ($Target =~ /https:/) {
            $OUT .= "    RewriteRule .* wss://$ws\%\{REQUEST_URI\} [P,L]";
        } elsif ($Target =~ /http:/) {
            $OUT .= "    RewriteRule .* ws://$ws\%\{REQUEST_URI\} [P,L]";
        }
    }
}

    ProxyPass  / { ($OUT = $Target) =~ s|/*$|/| } max=3 retry=30
    ProxyPassReverse / { ($OUT = $Target) =~ s|/*$|/| }

